<!DOCTYPE HTML>
<html>
    <head>
        <title>GObject 설명</title>
        <meta charset="utf-8">
    </head>
    <body>
<p><!-- #######  YAY, I AM THE SOURCE EDITOR! #########--></p>
<p>&nbsp;</p>
<h2>주요 객채</h2>
<ul>
<li>Sprite</li>
<li>Tile</li>
<li>new Container</li>
<li>Rect</li>
<li>Vector2</li>
<li><strong>new GObject</strong></li>
</ul>
<p><span style="color: #ff0000;">(new 가 붙은 객체는 new를 필수로 입력해 줘야 하는 객체입니다.)</span></p>
<p>&nbsp;</p>
<h3>리소스를 등록 하는 방법.</h3>
<p><span class="pl-smi">Resource</span>.<span class="pl-en">addImage</span>(태그, 이미지주소, callback);</p>
<p>addImage 함수로 이미지를 로드한 뒤,</p>
<p>Resource.image.태그 를 참조해서 로드 된 이미지 객체에 접근 할 수 있습니다</p>
<p>&nbsp;</p>
<h3>프로그램을 실행 하는 방법.</h3>
<h3><span style="background-color: #ffff00;">Run(Dom Canvas);</span></h3>
<p>&nbsp;</p>
<h3>글로벌 변수</h3>
<p>width : 캔버스 폭</p>
<p>height : 캔버스 높이</p>
<p>windowWidth : 윈도우 폭</p>
<p>windowHeight : 윈도우 높이</p>
<p>&nbsp;</p>
<p><strong>현재 클릭된 마우스 버튼 확인하는 법</strong></p>
<p>mouseIsPressed</p>
<p>{</p>
<p>left:[true / false],</p>
<p>right:[true / false],</p>
<p>middle:[true / false]</p>
<p>}</p>
<p><strong>현재 누르고 있는 키 확인하는 법</strong></p>
<p><strong>isKeyDown(keyCode)</strong></p>
<p>&nbsp;</p>
<p><strong>바로 과거에 누르고 있는 키 확인하는 법</strong></p>
<p><strong>wasKeyDown(keyCode)</strong></p>
<p>isKeyDown 으로 키코드 확인시,</p>
<p>keyDown 에서는 무조건 true</p>
<p>keyUp 에서는 무조건 false가 나오는 경우가 있다.</p>
<p>&nbsp;</p>
<h3><span style="background-color: #ffff00;">글로벌 함수</span></h3>
<p>Setup(ctx)</p>
<p>Run 실행후 최초 실행되는 함수.&nbsp;</p>
<p>&nbsp;</p>
<p>Draw(ctx)</p>
<p>Setup 함수 실행후 Draw함수가 실행되는데, 이 함수가 <strong>메인루프 함수</strong>이다.</p>
<p>이때 ctx 는 canvas context 입니다.</p>
<p>&nbsp;</p>
<h3>이벤트 함수</h3>
<p>mouseClick(현재 클릭된 위치 Vector2, 이전에 클릭된 위치 Vector2)</p>
<p>mouseDown(현재 이벤트 위치 Vector2, 이전에&nbsp;이벤트 위치 Vector2)</p>
<p>mouseUp(현재 이벤트 위치 Vector2, 이전에&nbsp;이벤트 위치 Vector2)</p>
<p>mouseMove(현재 이벤트 위치 Vector2, 이전에&nbsp;이벤트 위치 Vector2)</p>
<p>(위치는 캔버스 좌표 입니다.)</p>
<p>&nbsp;</p>
<p>keyDown(keyCode)</p>
<p>keyDown(keyUp)</p>
<p>&nbsp;</p>
<h3>Sprite 객체</h3>
<p>스프라이트 생성자</p>
<p><strong>new Sprite(이미지, 프레임 배열, 업데이트 딜레이 ms)</strong></p>
<p>Sprite는 단순하게 이미지를 출력하고, 애니메이션을 재생하기 (이미지를 잇기) 위한 객체입니다.</p>
<p>물론 이 속성에도 위치 속성이 있지만, 단순히 Container 내에서의 위치조정을 위한 역할로 사용하길 권장 합니다.</p>
<p>&nbsp;</p>
<p><strong>Sprite 함수</strong></p>
<p><span style="text-decoration: underline;">Sprite.setPosition(매개변수)</span></p>
<p><span style="background-color: #ffff00;">매개변수</span></p>
<p><span style="background-color: #ffff00;">(Vector2) 혹은 (x, y)</span></p>
<p>&nbsp;</p>
<p>스프라이트의 위치를 지정 합니다. Container 내에서 위치를 조정하기 위해서만 사용 해 주세요.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Sprite.getWidth()</span></p>
<p><span style="text-decoration: underline;">Sprite.getHeight()</span></p>
<p><span style="text-decoration: underline;">Sprite.nowFrame</span></p>
<p>스프라이트 재생시 현재 프레임(nowFrame) 이라는 속성이 있습니다.</p>
<p>스프라이트 애니메이션을 위해 Rect 객체로 영역을 지정해 줘 이미지를 재생하는데,</p>
<p>지금 화면에 출력된 이미지의 Rect 정보가 스프라이트의 현재프레임이 됩니다<span style="text-decoration: underline;">.</span></p>
<p><span style="text-decoration: underline;">Sprite.getWidth() 는 Sprite.nowFrame.width 와 동일 합니다.</span></p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Sprite.applyFrame(매개변수)</span></p>
<p><span style="background-color: #ffff00;">매개변수</span></p>
<p><span style="background-color: #ffff00;">([Rect 배열])</span></p>
<p><span style="background-color: #ffff00;">(Rect, Rect, Rect, ...)</span></p>
<p>Sprite의 프레임을 새로 적용합니다.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Sprite.clearFrame()</span></p>
<p>현재 프레임의 인덱스를 0 으로 재설정합니다.</p>
<p>즉 스프라이트 애니메이션을 첫프레임으로 재설정합니다.</p>
<p>또한 스프라이트 업데이트 딜레이 계산을 위한 이전시간(oldAniTime) 속성값을 현재 시간으로 재설정합니다.</p>
<p>&nbsp;</p>
<h3>Tile 객체</h3>
<p>Tile 객체는 사실상, 1 frame 스프라이트 객체입니다.</p>
<p>Tile 객체를 호출하면 Sprite 생성자를 호출해 반환 하기 때문에 Tile 객체와 Sprite는 결국 동일합니다.</p>
<p>하지만 GObject에 프레임이 1개 보다 많은 Sprite 객체를 연결하면 스프라이트 애니메이션이 중복되어 출력 되는데,</p>
<p>Tile 같이 단일 프레임 Sprite 객체는, 새로이 객체를 생성하지않아도 GObject객체와 연결해서 사용할 수 있습니다.</p>
<p>프레임이 1개인 이미지 처럼 사용되는 Sprite 객체는 Tile객체로 선언하십시오.</p>
<p>&nbsp;</p>
<h3>Container 객체</h3>
<p>Container 생성자</p>
<p>new Container(Sprite, Sprite, Sprite ....)</p>
<p>&nbsp;</p>
<p>Container 객체는 Sprite(와 Tile) 객체를 묶어 놓을 수 있는 객체입니다.</p>
<p>Container 객체안에 Sprite 객체를 등록하여 묶은 뒤 GObject에 등록하면 GObject의 위치변경 시, 함께 움직입니다.</p>
<p>Container 안에서 Sprite 객체의 위치 조정은 Sprite.setPosition() 함수를 사용하세요.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">Container.applyItem(매개변수)</span></p>
<p><span style="background-color: #ffff00;">매개변수</span></p>
<p><span style="background-color: #ffff00;">(Sprite, Sprite, Sprite ...)</span></p>
<p>&nbsp;</p>
<p>이 함수는 Container 의 생성자 형식과 똑같습니다.</p>
<p>새로이 Container 내의 아이템을 재설정 합니다.</p>
<p>&nbsp;</p>
<p><strong>Item 접근</strong></p>
<p><strong>Container.items[index] = Container 객체 안에 등록된 Sprite 객체</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>GObject 객체</h3>
<p>생성자</p>
<p><strong>GObject(Sprite(=Tile) 혹은 Container, 위치, 속도, 가속도)</strong></p>
<p>(위치 속도 가속도 는 각각 <strong>Vector2()</strong> 형식으로 입력해주세요.)</p>
<p>GObject 객체는 출력과 충돌, 게임전반의 로직에 주요한 오브젝트 입니다.</p>
<p>GObject 객체는 선언만해도 화면에 출력됩니다.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">GObject.getItem()</span></p>
<p>생성자 처음 매개변수로 전달된 Sprite, Container 객체를 반환 합니다.</p>
<p><span style="text-decoration: underline;">GObject.changeItem(<span style="background-color: #ffff00;">Container or Sprite</span>)</span></p>
<p>GObject에 등록되어져 있는&nbsp;Sprite, Container 객체를 새로운 객체로 변경 합니다.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">GObject.getPosition() &nbsp;위치벡터를 반환합니다.</span></p>
<p><span style="text-decoration: underline;">GObject.getVelocity() 속도 벡터를 반환합니다.</span></p>
<p><span style="text-decoration: underline;">GObject.getAcceleration() 가속도 벡터를 반환합니다.</span></p>
<p>&nbsp;</p>
<p>setPosition , setVelocity , setAcceleration 함수의 매개변수는</p>
<p><span style="background-color: #ffff00;">(Vector2) 혹은 (x,y) 형식</span>으로 입력할 수 있습니다.</p>
<p><span style="text-decoration: underline;">GObject.setPosition() &nbsp;위치벡터를 지정합니다.</span></p>
<p><span style="text-decoration: underline;">GObject.setVelocity() 속도 벡터를 지정합니다.</span></p>
<p><span style="text-decoration: underline;">GObject.setAcceleration() 가속도 벡터를 지정합니다.</span></p>
<p>&nbsp;</p>
<p><strong>GObject.applyGeometry(매개변수)</strong></p>
<p><span style="background-color: #ffff00;">매개변수</span></p>
<p><span style="background-color: #ffff00;">(Rect, Rect,Rect ...)</span></p>
<p>&nbsp;</p>
<p>GObject에는 충돌처리를 위한 geometry 객체가있습니다.</p>
<p>geometry 객체는 Rect배열로 이루어져있어 단순한 Rect로도 정밀한(?) 충돌감지가 가능합니다.</p>
<p>이 객체는 생성자 정의 항목에 존재하지 않습니다.</p>
<p>이 항목이 정의되지않은 상태에서는 Sprite의 첫프레임의 크기혹은 Container의 크기가 유일한 Rect가 됩니다.</p>
<p>&nbsp;</p>
<p>GObject의 geomtry을 이루는 Rect를 캔버스 내에서 출력하기위해</p>
<p><span style="text-decoration: underline;">GObject.drawGeometry(<span style="background-color: #ffff00;">2d cotext</span>)</span> 함수를 이용할 수 있습니다.</p>
<p><span style="text-decoration: underline;">GObject.drawRect(<span style="background-color: #ffff00;">2d cotext</span>)</span> 함수를 이용하여 전체적인 geometry의 틀을 출력해 볼 수 있습니다.</p>
<p>&nbsp;</p>
<p>GObject.getRect()</p>
<p>전체적인 geometry의 틀을 출력합니다. 반환형 Rect.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">GObject.inWindow()</span></p>
<p>객체가 화면 안에 있는지 확인 합니다.</p>
<p>&nbsp;</p>
<p><span style="text-decoration: underline;">GObject.isCollsion(매개변수)</span></p>
<p><span style="background-color: #ffff00;">매개변수</span></p>
<p><span style="background-color: #ffff00;">(GObject 객체)</span></p>
<p><span style="background-color: #ffff00;">(Rect 객체)</span></p>
<p>isCollision 함수는 GObject 끼리의 충돌 혹은 Rect 객체와의 충돌을 체크 할 수 있습니다.</p>
<p>충돌 시 true, 아닐 시 false 반환.</p>
<p>&nbsp;</p>
<p>GObject.active</p>
<p>이 값이 false 면 업데이트도 출력도 하지않습니다.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>Vector2 객체</h3>
<p>생성자 Vector2(x,y)</p>
<p>함수</p>
<p>Vector2.sum(Vector2) : 벡터를 더합니다.</p>
<p>Vector2.sub(Vector2) : 벡터를 뺍니다.</p>
<p>Vector2.normalize() : 벡터를 normalize 합니다. (방향성만 얻음, 크기 1)</p>
<p>Vector2.mul(Vector2 or number) : 벡터를 곱하거나, 숫자를 곱합니다.</p>
<p>Vector2.len() : 벡터의 크기를 반환합니다.</p>
<p>&nbsp;</p>
<p>벡터인지 아닌지 판단.</p>
<p>Vector.isVector(매개변수) : Vector2 이면 true 아니면 false</p>
<p>&nbsp;</p>
<h3>Rect 객체</h3>
<p>속성&nbsp;</p>
<p>{</p>
<p>x:number,</p>
<p>y:number,</p>
<p>width:number,</p>
<p>height:number</p>
<p>}</p>
<p>함수</p>
<p><span style="background-color: #ffff00;">Rect.isCollision(Rect) : Rect객체 끼리 서로 충돌했는지 확인 합니다.</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre style="background:#000;color:#f8f8f8">(<span style="color:#99cf50">function</span> () {
    <span style="color:#99cf50">var</span> canvas <span style="color:#e28964">=</span> <span style="color:#9b859d">document</span>.<span style="color:#dad085">getElementById</span>(<span style="color:#65b042">'DOMcanvas'</span>);
    <span style="color:#aeaeae;font-style:italic">/********* preload *********/</span>
    Resource.addImage(<span style="color:#65b042">'sky'</span>, <span style="color:#65b042">'./resources/Sky.png'</span>, preload);
    Resource.addImage(<span style="color:#65b042">'city'</span>, <span style="color:#65b042">'./resources/City Background.png'</span>, preload);
    Resource.addImage(<span style="color:#65b042">'cityF'</span>, <span style="color:#65b042">'./resources/City Foreground.png'</span>, preload);

    Resource.addImage(<span style="color:#65b042">'character'</span>, <span style="color:#65b042">'./resources/character.png'</span>, preload);
    Resource.addImage(<span style="color:#65b042">'tileset'</span>, <span style="color:#65b042">'./resources/tileset.png'</span>, preload);
    <span style="color:#99cf50">var</span> loaded <span style="color:#e28964">=</span> <span style="color:#3387cc">0</span>;
    <span style="color:#99cf50">var</span> max <span style="color:#e28964">=</span> <span style="color:#3387cc">5</span>;
    <span style="color:#99cf50">function</span> <span style="color:#89bdff">preload</span>() {
        <span style="color:#e28964">if</span> (<span style="color:#e28964">++</span>loaded <span style="color:#e28964">==</span> max) {
            <span style="color:#aeaeae;font-style:italic">//Run Program</span>
            Run(canvas);
        }
    }
})();

<span style="color:#99cf50">var</span> background;

<span style="color:#99cf50">var</span> player;
<span style="color:#99cf50">var</span> sprite;
<span style="color:#99cf50">var</span> state;

<span style="color:#99cf50">function</span> <span style="color:#89bdff">Setup</span>(ctx) {
    background <span style="color:#e28964">=</span> <span style="color:#e28964">new</span> <span style="text-decoration:underline">GObject</span>(
        <span style="color:#e28964">new</span> <span style="text-decoration:underline">Container</span>(
            Tile(Resource.image.sky),
            Tile(Resource.image.cityF).setPosition(<span style="color:#3387cc">0</span>, <span style="color:#e28964">-</span><span style="color:#3387cc">100</span>),
            Tile(Resource.image.city).setPosition(<span style="color:#3387cc">0</span>, <span style="color:#3387cc">50</span>)
        )
    );
    sprite <span style="color:#e28964">=</span> {
        stand: {
            left: Sprite(Resource.image.character, Rect(<span style="color:#3387cc">3</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>)),
            right: Sprite(Resource.image.character, Rect(<span style="color:#3387cc">3</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>))
        },
        move: {
            left: Sprite(Resource.image.character,
                [Rect(<span style="color:#3387cc">28</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">51</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">23</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">78</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">100</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">25</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">128</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">151</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">23</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">3</span>, <span style="color:#3387cc">114</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>)]
            ),
            right: Sprite(Resource.image.character,
                [Rect(<span style="color:#3387cc">28</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">51</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">23</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">78</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">100</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">25</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">128</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">151</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">23</span>, <span style="color:#3387cc">54</span>), Rect(<span style="color:#3387cc">3</span>, <span style="color:#3387cc">170</span>, <span style="color:#3387cc">19</span>, <span style="color:#3387cc">54</span>)]
            )
        }
    };
    player <span style="color:#e28964">=</span> <span style="color:#e28964">new</span> <span style="text-decoration:underline">GObject</span>(sprite.stand.<span style="color:#cf6a4c">right</span>);
    player.setPosition(width / <span style="color:#3387cc">2</span> <span style="color:#e28964">-</span> <span style="color:#3387cc">9.5</span>, height / <span style="color:#3387cc">2</span> <span style="color:#e28964">-</span> <span style="color:#3387cc">27</span>);
    player.<span style="color:#cf6a4c">status</span>.speed <span style="color:#e28964">=</span> <span style="color:#3387cc">50</span>;
    <span style="color:#aeaeae;font-style:italic">// player.setVelocity(50, 0);</span>
}

<span style="color:#99cf50">function</span> <span style="color:#89bdff">Draw</span>() {
    <span style="color:#99cf50">var</span> pos <span style="color:#e28964">=</span> player.getPosition();
    <span style="color:#e28964">if</span> (player.inWindow()) {
        background.getItem().items[<span style="color:#3387cc">1</span>].setPosition(<span style="color:#e28964">-</span><span style="color:#9b859d">Math</span>.<span style="color:#dad085">max</span>(<span style="color:#3387cc">0</span>, pos.<span style="color:#cf6a4c">x</span> <span style="color:#e28964">*</span> <span style="color:#3387cc">0.1</span>), <span style="color:#e28964">-</span><span style="color:#3387cc">150</span>);
        background.getItem().items[<span style="color:#3387cc">2</span>].setPosition(<span style="color:#e28964">-</span><span style="color:#9b859d">Math</span>.<span style="color:#dad085">max</span>(<span style="color:#3387cc">0</span>, pos.<span style="color:#cf6a4c">x</span> <span style="color:#e28964">*</span> <span style="color:#3387cc">0.6</span>), <span style="color:#3387cc">50</span>);
    }
}

<span style="color:#99cf50">function</span> <span style="color:#89bdff">keyDown</span>(keyCode) {
    <span style="color:#e28964">if</span> (<span style="color:#e28964">!</span>wasKeyDown(keyCode)) {
        <span style="color:#99cf50">var</span> nSprite;
        <span style="color:#99cf50">var</span> speed <span style="color:#e28964">=</span> player.<span style="color:#cf6a4c">status</span>.speed;
        <span style="color:#e28964">switch</span> (keyCode) {
            <span style="color:#e28964">case</span> <span style="color:#3387cc">39</span>:
                nSprite <span style="color:#e28964">=</span> sprite.move.<span style="color:#cf6a4c">right</span>;
                player.setVelocity(speed, <span style="color:#3387cc">0</span>);
                <span style="color:#e28964">break</span>;
            <span style="color:#e28964">case</span> <span style="color:#3387cc">37</span>:
                nSprite <span style="color:#e28964">=</span> sprite.move.<span style="color:#cf6a4c">left</span>;
                player.setVelocity(<span style="color:#e28964">-</span>speed, <span style="color:#3387cc">0</span>);
                <span style="color:#e28964">break</span>;
        }
        <span style="color:#e28964">if</span> (nSprite) {
            player.changeItem(nSprite.clearFrame());
            player.<span style="color:#cf6a4c">status</span>.keyCode <span style="color:#e28964">=</span> keyCode;
        }
    }
}

<span style="color:#99cf50">function</span> <span style="color:#89bdff">keyUp</span>(keyCode){
    <span style="color:#e28964">if</span>(keyCode <span style="color:#e28964">===</span> player.<span style="color:#cf6a4c">status</span>.keyCode){
        <span style="color:#99cf50">var</span> direction <span style="color:#e28964">=</span> player.getVelocity().<span style="color:#cf6a4c">x</span> <span style="color:#e28964">&lt;</span> <span style="color:#3387cc">0</span> ? <span style="color:#65b042">'left'</span> : <span style="color:#65b042">'right'</span>;
        player.setVelocity(<span style="color:#3387cc">0</span>,<span style="color:#3387cc">0</span>);
        player.changeItem(sprite.stand[direction]);
        
        player.<span style="color:#cf6a4c">status</span>.keyCode <span style="color:#e28964">=</span> <span style="color:#3387cc">undefined</span>;
    }
}
</pre>
    </body>
</html>